<!DOCTYPE html>
<html lang="id" data-theme="">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>ZIP Archive List</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
    body { 
        font-family: 'Inter', sans-serif; 
        background:#f8f9fb; 
        color:#111; 
        min-height:100vh;
        transition:.3s; 
    }
    [data-theme="dark"] body{ background:#111; color:#fff; }

    .container{
        max-width:530px;
        margin:auto;
        margin-top:30px;
        background:#fff;
        border-radius:20px;
        padding:25px;
        box-shadow:0 4px 14px rgba(0,0,0,.08);
        transition:.3s;
    }
    [data-theme="dark"] .container{ background:#222; box-shadow:0 0 30px rgba(49,75,255,.15); }

    /* tombol */
    .btn{
        display:flex;
        align-items:center;
        justify-content:center;
        gap:8px;
        width:100%;
        padding:9px 0;
        transition:.2s;
        border-radius:10px;
        font-weight:600;
    }
    .btn-primary{ background:#4f46e5;color:#fff; }
    .btn-primary:hover{ background:#4338ca; }

    .btn-secondary{ background:#e5e7eb;color:#111; }
    .btn-secondary:hover{ background:#d1d5db; }
    [data-theme="dark"] .btn-secondary{ background:#3a3a3a;color:#fff; }

    /* anim refresh */
    .refresh-btn.loading svg { animation:spin-left 1s linear infinite; }
    @keyframes spin-left{from{transform:rotate(0)}to{transform:rotate(-360deg)}}

    /* galeri */
    .gallery-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:14px;}
    .gallery-list{display:flex!important;flex-direction:column;gap:12px;}

    .item-zip{
        padding:13px;
        border:1px solid #d1d5db;
        border-radius:15px;
        transition:.25s;
        text-align:center;
    }
    .item-zip:hover{box-shadow:0 0 12px rgba(0,0,0,.12);}
    [data-theme="dark"] .item-zip{border-color:#555;background:#333;}
</style>
</head>

<body id="appBody">

<div class="container">
    <h1 class="text-3xl font-bold text-center mb-6">ZIP Archive List</h1>

    <div class="border-b pb-4 mb-5">
        <h2 class="flex items-center gap-2 text-lg font-semibold mb-3">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M4 4h16v16H4zM6 8h2v2H6zm0 4h2v2H6zm0 4h2v2H6zm4-8h8v2h-8zm0 4h8v2h-8zm0 4h8v2h-8z"/></svg>
            Arsip File ZIP
        </h2>

        <div class="grid grid-cols-2 sm:grid-cols-3 gap-2">
            <button onclick="toggleView()" class="btn btn-secondary">
                <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M3 3h8v8H3zm10 0h8v8h-8zM3 13h8v8H3zm10 0h8v8h-8z"/></svg>
                Tampilan
            </button>
            <button onclick="toggleTheme()" class="btn btn-secondary">
                <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/></svg>
                Mode
            </button>
            <button id="refreshBtn" onclick="loadGallery()" class="btn btn-primary refresh-btn">
                <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M12 4V1L8 5l4 4V6c3.3 0 6 2.7 6 6"/></svg>
                Refresh
            </button>
        </div>
    </div>

    <label class="text-sm font-medium">Filter tanggal upload:</label>
    <input type="date" id="filterDate" onchange="loadGallery()" class="w-full mt-1 mb-4 p-2 border rounded-lg bg-gray-50 dark:bg-gray-700 dark:border-gray-600"/>

    <div id="gallery" class="gallery-grid">Memuat...</div>
</div>

<script>
const root=document.documentElement;
function toggleTheme(){setTheme(root.getAttribute("data-theme")==="dark"?"light":"dark");}
function setTheme(v){root.setAttribute("data-theme",v);localStorage.setItem("theme",v);}
(function(){setTheme(localStorage.getItem("theme")||"light")})();

function toggleView(){
    let g=document.getElementById('gallery');
    g.classList.toggle("gallery-list");
    g.classList.toggle("gallery-grid");
}

async function loadGallery(){
    let gallery=document.getElementById('gallery'),refreshBtn=document.getElementById('refreshBtn');
    refreshBtn.classList.add("loading");
    gallery.innerHTML="Memuat...";
    try{
        let res=await fetch("/api/list"),data=await res.json();
        if(!data.ok) throw Error(data.error||"Gagal mengambil data");
        const date=document.getElementById('filterDate').value;

        // **BARIS YANG DIPERBAIKI:**
        // Hanya memfilter berdasarkan tanggal jika ada, dan tidak lagi memfilter berdasarkan f.isZip.
        let files = data.files; 
        if (date) {
            files = data.files.filter(f => f.date?.slice(0, 10) === date);
        }

        if(!files.length) return gallery.innerHTML='<p class="text-center text-gray-500">Tidak ada file ditemukan.</p>'; // Pesan diubah

        gallery.innerHTML="";
        files.forEach(f=>{
            // Mengubah ikon menjadi ikon dokumen umum, karena file tidak lagi hanya ZIP.
            // Anda mungkin perlu menyesuaikan ikon berdasarkan jenis file yang sebenarnya (misalnya, menggunakan f.extension jika tersedia).
            const iconSvg = `<svg class="w-10 h-10 text-indigo-500" fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zM6 20V4h7v4h4v12H6z"/></svg>`;
            
            gallery.innerHTML+=`
            <div class="item-zip">
                <a href="${f.url}" download class="flex flex-col items-center gap-2">
                    ${iconSvg}
                    <span class="text-xs break-all">${f.name}</span>
                </a>
            </div>`;
        });
    }catch(e){
        gallery.innerHTML=`<p class="text-center text-red-500">${e.message}</p>`;
    }
    refreshBtn.classList.remove("loading");
}

window.addEventListener("DOMContentLoaded",loadGallery);
</script>

</body>
</html>
